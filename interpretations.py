# -------------------------------------
# DATA & INTERPRETATIONS (–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π)
# -------------------------------------

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
KEYWORDS = {
    "ru": {
        "Sun": "–°–∏–ª–∞ –≤–æ–ª–∏, –≠–≥–æ, –ñ–∏–∑–Ω–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è",
        "Moon": "–≠–º–æ—Ü–∏–∏, –î—É—à–∞, –ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ",
        "Mercury": "–ú—ã—à–ª–µ–Ω–∏–µ, –î–æ–∫—É–º–µ–Ω—Ç—ã, –û–±—â–µ–Ω–∏–µ",
        "Venus": "–õ—é–±–æ–≤—å, –î–µ–Ω—å–≥–∏, –ö–æ–º—Ñ–æ—Ä—Ç",
        "Mars": "–î–µ–π—Å—Ç–≤–∏–µ, –ê–≥—Ä–µ—Å—Å–∏—è, –°–ø–æ—Ä—Ç",
        "Jupiter": "–£–¥–∞—á–∞, –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç",
        "Saturn": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –£—Ä–æ–∫–∏",
        "Uranus": "–í–Ω–µ–∑–∞–ø–Ω–æ—Å—Ç—å, –†–µ–≤–æ–ª—é—Ü–∏—è, –°–≤–æ–±–æ–¥–∞",
        "Neptune": "–ò–ª–ª—é–∑–∏–∏, –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –•–∞–æ—Å",
        "Pluto": "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –í–ª–∞—Å—Ç—å, –ö—Ä–∏–∑–∏—Å"
    },
    "en": {
        "Sun": "Willpower, Ego, Vital Energy",
        "Moon": "Emotions, Soul, Subconscious",
        "Mercury": "Thinking, Documents, Communication",
        "Venus": "Love, Money, Comfort",
        "Mars": "Action, Aggression, Sport",
        "Jupiter": "Luck, Expansion, Authority",
        "Saturn": "Restriction, Discipline, Lessons",
        "Uranus": "Suddenness, Revolution, Freedom",
        "Neptune": "Illusions, Inspiration, Chaos",
        "Pluto": "Transformation, Power, Crisis"
    }
}

HOUSE_KEYWORDS = {
    "ru": {
        1: "–õ–∏—á–Ω–æ—Å—Ç—å/–ò–º–∏–¥–∂ (1 –¥–æ–º)",
        2: "–î–µ–Ω—å–≥–∏/–†–µ—Å—É—Ä—Å—ã (2 –¥–æ–º)",
        3: "–ö–æ–Ω—Ç–∞–∫—Ç—ã/–û–±—É—á–µ–Ω–∏–µ (3 –¥–æ–º)",
        4: "–î–æ–º/–°–µ–º—å—è (4 –¥–æ–º)",
        5: "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ/–õ—é–±–æ–≤—å/–î–µ—Ç–∏ (5 –¥–æ–º)",
        6: "–†–∞–±–æ—Ç–∞/–ó–¥–æ—Ä–æ–≤—å–µ (6 –¥–æ–º)",
        7: "–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ/–ë—Ä–∞–∫ (7 –¥–æ–º)",
        8: "–ö—Ä–∏–∑–∏—Å/–ß—É–∂–∏–µ —Ä–µ—Å—É—Ä—Å—ã (8 –¥–æ–º)",
        9: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è/–ú–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ (9 –¥–æ–º)",
        10: "–ö–∞—Ä—å–µ—Ä–∞/–°—Ç–∞—Ç—É—Å (10 –¥–æ–º)",
        11: "–î—Ä—É–∑—å—è/–ü–ª–∞–Ω—ã (11 –¥–æ–º)",
        12: "–ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ/–¢–∞–π–Ω—ã (12 –¥–æ–º)"
    },
    "en": {
        1: "Identity/Image (1st House)",
        2: "Money/Resources (2nd House)",
        3: "Contacts/Learning (3rd House)",
        4: "Home/Family (4th House)",
        5: "Creativity/Love/Children (5th House)",
        6: "Work/Health (6th House)",
        7: "Partnership/Marriage (7th House)",
        8: "Crisis/Shared Resources (8th House)",
        9: "Travel/Worldview (9th House)",
        10: "Career/Status (10th House)",
        11: "Friends/Plans (11th House)",
        12: "Subconscious/Secrets (12th House)"
    }
}

ASPECT_KEYWORDS = {
    "ru": {
        "Conjunction": "—Å–ª–∏–≤–∞–µ—Ç—Å—è —Å —ç–Ω–µ—Ä–≥–∏–µ–π",
        "Sextile": "–¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è",
        "Square": "—Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å",
        "Trine": "–≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç",
        "Opposition": "–ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ–∏—Ç"
    },
    "en": {
        "Conjunction": "merges with the energy of",
        "Sextile": "gives opportunities for",
        "Square": "creates conflict with",
        "Trine": "harmoniously supports",
        "Opposition": "opposes"
    }
}

# –ë–∞–∑–∞ —Ç–æ—á–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–π
INTERPRETATIONS_DB = {
    "ru": {
        "Pluto Conjunction Sun": "üî• [–†–∞–∑ –≤ –∂–∏–∑–Ω–∏] –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ª–∏—á–Ω–æ—Å—Ç–∏. –°—Ç–∞—Ä–æ–µ '–Ø' —É–º–∏—Ä–∞–µ—Ç, —Ä–æ–∂–¥–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ. –ü–µ—Ä–∏–æ–¥ –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω–æ–π –≤–ª–∞—Å—Ç–∏, –Ω–æ –∏ –¥–∞–≤–ª–µ–Ω–∏—è –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤.",
        "Pluto Square Sun": "‚ö†Ô∏è [–†–∞–∑ –≤ –∂–∏–∑–Ω–∏] –ë–∏—Ç–≤–∞ –∑–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ –∏ –≤–ª–∞—Å—Ç—å. –í–∞—à–µ —ç–≥–æ –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è –∂–µ—Å—Ç–∫–æ–º—É –¥–∞–≤–ª–µ–Ω–∏—é.",
        "Saturn Conjunction Sun": "üß± [–†–∞–∑ –≤ 29 –ª–µ—Ç] –ü–µ—Ä–∏–æ–¥ –≤–∑—Ä–æ—Å–ª–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –ñ–∏–∑–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–µ—Ä—å–µ–∑–Ω–æ–π.",
        # ... (other existing RU entries would go here)
    },
    "en": {
        "Pluto Conjunction Sun": "üî• [Once in a lifetime] Complete personality reset. The old 'I' dies, a new one is born. A period of colossal power, but also pressure of circumstances.",
        "Pluto Square Sun": "‚ö†Ô∏è [Once in a lifetime] Battle for survival and power. Your ego is under severe pressure.",
        "Saturn Conjunction Sun": "üß± [Once in 29 years] A period of maturity and responsibility. Life becomes serious.",
    }
}

# –®–∞–±–ª–æ–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
TEMPLATES = {
    "ru": {
        "Tense": [
            "–ù–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. {t_name} –±—Ä–æ—Å–∞–µ—Ç –≤—ã–∑–æ–≤ {n_name}. –í–æ–∑–º–æ–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —Å—Ñ–µ—Ä–∞–º–∏: {t_desc} –∏ {n_desc}.",
            "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤: {t_name} –≤ —Å—Ñ–µ—Ä–µ '{t_house_desc}' –Ω–∞—Ä—É—à–∞–µ—Ç –ø–ª–∞–Ω—ã {n_name} –≤ —Å—Ñ–µ—Ä–µ '{n_house_desc}'.",
        ],
        "Harmonic": [
            "‚ú® –ì–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π –ø–æ—Ç–æ–∫. {t_name} —É–¥–∞—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç {n_name}. –õ–µ–≥–∫–æ —Ä–µ—à–∞—é—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å: {n_desc}.",
            "–£—Å–ø–µ—Ö —á–µ—Ä–µ–∑ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: {t_name} –∏–∑ —Å—Ñ–µ—Ä—ã '{t_house_desc}' –ø–æ–º–æ–≥–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ {n_name} –≤ '{n_house_desc}'.",
        ],
        "Neutral": [
            "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–π. {t_name} –∏ {n_name} –¥–µ–π—Å—Ç–≤—É—é—Ç –∑–∞–æ–¥–Ω–æ. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–≥–æ –≤—ã–±–æ—Ä–∞.",
            "–ê–∫—Ü–µ–Ω—Ç –≥–æ–¥–∞: {t_name} –≤ '{t_house_desc}' —Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å {n_name} ({n_house_desc}).",
        ]
    },
    "en": {
        "Tense": [
            "Tense period. {t_name} challenges {n_name}. Possible conflict between: {t_desc} and {n_desc}.",
            "Conflict of interests: {t_name} in the sphere of '{t_house_desc}' disrupts the plans of {n_name} in '{n_house_desc}'.",
        ],
        "Harmonic": [
            "‚ú® Harmonious flow. {t_name} successfully supports {n_name}. Matters related to {n_desc} are easily resolved.",
            "Success through interaction: {t_name} from the sector of '{t_house_desc}' helps the realization of {n_name} in '{n_house_desc}'.",
        ],
        "Neutral": [
            "Merging of energies. {t_name} and {n_name} act together. The result depends on your conscious choice.",
            "Year highlight: {t_name} in '{t_house_desc}' conjuncts {n_name} ({n_house_desc}). Important event in these sectors.",
        ]
    }
}

def get_aspect_nature(aspect, t_planet):
    if aspect in ["Square", "Opposition"]: return "Tense"
    if aspect in ["Trine", "Sextile"]: return "Harmonic"
    if aspect == "Conjunction":
        if t_planet in ["Mars", "Saturn", "Uranus", "Neptune", "Pluto"]: return "Tense"
        return "Neutral"
    return "Neutral"

def get_interpretation(t_name, aspect, n_name, t_house=None, n_house=None, lang="ru"):
    key = f"{t_name} {aspect} {n_name}"
    
    # 1. Search in DB
    db = INTERPRETATIONS_DB.get(lang, INTERPRETATIONS_DB["ru"])
    if key in db: return db[key]
    if lang != "ru" and key in INTERPRETATIONS_DB["ru"]: return INTERPRETATIONS_DB["ru"][key]
    
    # 2. Generator
    nature = get_aspect_nature(aspect, t_name)
    lang_templates = TEMPLATES.get(lang, TEMPLATES["ru"])
    
    t_desc = KEYWORDS.get(lang, KEYWORDS["ru"]).get(t_name, t_name)
    n_desc = KEYWORDS.get(lang, KEYWORDS["ru"]).get(n_name, n_name)
    
    h_db = HOUSE_KEYWORDS.get(lang, HOUSE_KEYWORDS["ru"])
    t_house_desc = h_db.get(t_house, f"{t_house} house") if t_house else "Transit"
    n_house_desc = h_db.get(n_house, f"{n_house} house") if n_house else "Natal"
    
    idx = hash(key + str(t_house) + str(n_house)) % len(lang_templates[nature])
    template = lang_templates[nature][idx]
    
    return template.format(
        t_name=t_name, n_name=n_name, 
        t_desc=t_desc, n_desc=n_desc,
        t_house_desc=t_house_desc, n_house_desc=n_house_desc
    )

def get_planet_rarity(t_name, lang="ru"):
    rarity_map = {
        "ru": {
            "Sun": "1 —Ä–∞–∑ –≤ –≥–æ–¥", "Mercury": "1 —Ä–∞–∑ –≤ –≥–æ–¥", "Venus": "1 —Ä–∞–∑ –≤ –≥–æ–¥",
            "Mars": "1 —Ä–∞–∑ –≤ 2 –≥–æ–¥–∞", "Jupiter": "1 —Ä–∞–∑ –≤ 12 –ª–µ—Ç", "Saturn": "1 —Ä–∞–∑ –≤ 29 –ª–µ—Ç",
            "Uranus": "1 —Ä–∞–∑ –≤ 84 –≥–æ–¥–∞", "Neptune": "1 —Ä–∞–∑ –≤ 165 –ª–µ—Ç", "Pluto": "1 —Ä–∞–∑ –≤ 248 –ª–µ—Ç"
        },
        "en": {
            "Sun": "Once a year", "Mercury": "Once a year", "Venus": "Once a year",
            "Mars": "Once in 2 years", "Jupiter": "Once in 12 years", "Saturn": "Once in 29 years",
            "Uranus": "Once in 84 years", "Neptune": "Once in 165 years", "Pluto": "Once in 248 years"
        }
    }
    return rarity_map.get(lang, rarity_map["ru"]).get(t_name, None)
